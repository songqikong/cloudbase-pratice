<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading && videoList.length === 0}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½ç²¾å½©è§†é¢‘...</text>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{!loading && videoList.length === 0}}" class="empty-container">
    <view class="empty-icon">ğŸ“¹</view>
    <text class="empty-text">æš‚æ— è§†é¢‘å†…å®¹</text>
    <text class="empty-hint">å¿«å»å‘å¸ƒç¬¬ä¸€ä¸ªè§†é¢‘å§ï¼</text>
    <button class="retry-btn" bindtap="onRetry">é‡æ–°åŠ è½½</button>
    <button class="retry-btn" bindtap="debugTestCloudFunction" style="margin-top: 20rpx; background: #4CAF50;">æµ‹è¯•äº‘å‡½æ•°</button>
  </view>
  
  <!-- è§†é¢‘åˆ—è¡¨ -->
  <swiper 
    wx:else
    class="video-swiper" 
    vertical="{{true}}" 
    current="{{currentIndex}}"
    bindchange="onSwiperChange"
    circular="{{false}}"
    duration="300"
  >
    <swiper-item wx:for="{{videoList}}" wx:key="_id" class="video-item">
      <view class="video-container">
        <!-- è§†é¢‘æ’­æ”¾å™¨ -->
        <video 
          id="video-{{index}}"
          class="video-player"
          src="{{item.videoUrl}}"
          poster="{{item.poster}}"
          object-fit="contain"
          show-center-play-btn="{{false}}"
          show-play-btn="{{false}}"
          controls="{{false}}"
          loop="{{true}}"
          muted="{{true}}"
          autoplay="{{index === currentIndex && isPlaying}}"
          enable-progress-gesture="{{false}}"
          enable-play-gesture="{{true}}"
          bindtap="onVideoTap"
          bindplay="onVideoPlay"
          bindpause="onVideoPause"
        ></video>

        <!-- æš‚åœå›¾æ ‡ -->
        <view class="pause-overlay {{!isPlaying ? 'show' : ''}}" bindtap="onVideoTap">
          <view class="pause-icon">â–¶ï¸</view>
        </view>

        <!-- å³ä¾§æ“ä½œæ  -->
        <view class="right-actions">
          <!-- ç”¨æˆ·å¤´åƒ -->
          <view class="user-avatar" bindtap="onUserProfile" data-username="{{item.author.nickname || item.author.username || 'ç”¨æˆ·'}}">
            <image src="{{item.author.avatar || item.author && item.author.avatar || '/images/user-avatar.jpg'}}" class="avatar-img"></image>
            <view class="follow-btn" bindtap="onFollow" catchtap="true">+</view>
          </view>

          <!-- ç‚¹èµ -->
          <view class="action-item" bindtap="onLike" data-index="{{index}}">
            <view class="action-icon like-icon {{item.isLiked ? 'liked' : ''}}">
              â¤ï¸
            </view>
            <text class="action-text">{{item.likes || 0}}</text>
          </view>

          <!-- è¯„è®º -->
          <view class="action-item" bindtap="onComment">
            <view class="action-icon">ğŸ’¬</view>
            <text class="action-text">{{item.comments || 0}}</text>
          </view>

          <!-- åˆ†äº« -->
          <view class="action-item" bindtap="onShare" data-index="{{index}}">
            <view class="action-icon">ğŸ“¤</view>
            <text class="action-text">{{item.shares || 0}}</text>
          </view>

          <!-- éŸ³ä¹ -->
          <view class="music-disc">
            <view class="disc-bg">ğŸµ</view>
          </view>
        </view>

        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <view class="bottom-info">
          <view class="user-info">
            <text class="username">@{{item.author.nickname || item.author.username || 'åŒ¿åç”¨æˆ·'}}</text>
            <text class="description">{{item.title || item.description}}</text>
            <!-- æ ‡ç­¾æ˜¾ç¤º -->
            <view wx:if="{{item.tags && item.tags.length > 0}}" class="tags-container">
              <text wx:for="{{item.tags}}" wx:key="*this" class="tag">#{item}</text>
            </view>
          </view>
          
          <!-- ä½ç½®ä¿¡æ¯ -->
          <view wx:if="{{item.location}}" class="location-info">
            <view class="location-icon">ğŸ“</view>
            <text class="location-text">{{item.location}}</text>
          </view>
        </view>
      </view>
    </swiper-item>
  </swiper>
  
  <!-- åŠ è½½æ›´å¤šæç¤º -->
  <view wx:if="{{loading && videoList.length > 0}}" class="load-more">
    <view class="loading-spinner small"></view>
    <text>åŠ è½½æ›´å¤š...</text>
  </view>
  
  <!-- è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆª -->
  <custom-tabbar></custom-tabbar>
</view> 