<view class="container">
  <!-- æ¯›ç»ç’ƒèƒŒæ™¯è£…é¥° -->
  <view class="bg-decoration">
    <view class="bg-circle"></view>
    <view class="bg-circle"></view>
    <view class="bg-circle"></view>
  </view>

  <scroll-view scroll-y="{{true}}" class="content">
    
    <!-- ç”¨æˆ·å¤´éƒ¨ä¿¡æ¯ -->
    <view class="user-header glass-card">
      <view class="user-basic">
        <view class="avatar-container">
          <image src="{{userInfo.avatar}}" class="user-avatar"></image>
          <view wx:if="{{userInfo.isVerified}}" class="verified-badge">âœ“</view>
        </view>
        
        <view class="user-info">
          <view class="nickname-row">
            <text class="nickname">{{userInfo.nickname}}</text>
            <view class="action-buttons">
              <button class="edit-btn btn-feedback" bindtap="editProfile">ç¼–è¾‘èµ„æ–™</button>
              <button class="settings-btn btn-feedback" bindtap="openSettings">âš™ï¸</button>
            </view>
          </view>
          <text class="signature" bindtap="editSignature">{{userInfo.signature || 'ç‚¹å‡»ç¼–è¾‘ä¸ªæ€§ç­¾å'}}</text>
        </view>
      </view>

      <!-- æ•°æ®ç»Ÿè®¡ -->
      <view class="stats-container">
        <view class="stat-item" bindtap="viewFollowers">
          <text class="stat-number">{{userInfo.followersCount}}</text>
          <text class="stat-label">ç²‰ä¸</text>
        </view>
        <view class="stat-item" bindtap="viewFollowing">
          <text class="stat-number">{{userInfo.followingCount}}</text>
          <text class="stat-label">å…³æ³¨</text>
        </view>
        <view class="stat-item" bindtap="viewLikes">
          <text class="stat-number">{{userInfo.likesCount}}</text>
          <text class="stat-label">è·èµ</text>
        </view>
      </view>
    </view>

    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
    <view class="tab-container glass-card">
      <view class="tabs">
        <view 
          wx:for="{{tabList}}" 
          wx:key="index"
          class="tab-item {{tabIndex === index ? 'active' : ''}}"
          data-index="{{index}}"
          bindtap="onTabChange"
        >
          {{item}}
        </view>
      </view>
    </view>

    <!-- è§†é¢‘å†…å®¹åŒºåŸŸ -->
    <view class="video-content">
      <!-- ä½œå“åˆ—è¡¨ -->
      <view wx:if="{{tabIndex === 0}}" class="video-grid">
        <view 
          wx:for="{{videoList}}" 
          wx:key="_id"
          class="video-item"
          data-id="{{item._id}}"
          bindtap="playVideo"
        >
          <image 
            src="{{item.poster}}" 
            class="video-poster" 
            mode="aspectFill"
            lazy-load="{{true}}"
            binderror="onImageError"
            bindload="onImageLoad"
            data-index="{{index}}"
          ></image>
          <view class="video-overlay">
            <view class="video-likes">â¤ {{item.likes}}</view>
          </view>
          <view class="play-icon">â–¶</view>
        </view>
      </view>

      <!-- å–œæ¬¢åˆ—è¡¨ -->
      <view wx:if="{{tabIndex === 1}}" class="video-grid">
        <view 
          wx:for="{{likedVideos}}" 
          wx:key="_id"
          class="video-item"
          data-id="{{item._id}}"
          bindtap="playVideo"
        >
          <image 
            src="{{item.poster}}" 
            class="video-poster" 
            mode="aspectFill"
            lazy-load="{{true}}"
            binderror="onImageError"
            bindload="onImageLoad"
            data-index="{{index}}"
          ></image>
          <view class="video-overlay">
            <view class="video-likes">â¤ {{item.likes}}</view>
          </view>
          <view class="play-icon">â–¶</view>
        </view>
      </view>

      <!-- æ”¶è—åˆ—è¡¨ -->
      <view wx:if="{{tabIndex === 2}}" class="video-grid">
        <view 
          wx:for="{{collectedVideos}}" 
          wx:key="_id"
          class="video-item"
          data-id="{{item._id}}"
          bindtap="playVideo"
        >
          <image 
            src="{{item.poster}}" 
            class="video-poster" 
            mode="aspectFill"
            lazy-load="{{true}}"
            binderror="onImageError"
            bindload="onImageLoad"
            data-index="{{index}}"
          ></image>
          <view class="video-overlay">
            <view class="video-likes">â¤ {{item.likes}}</view>
          </view>
          <view class="play-icon">â–¶</view>
        </view>
      </view>

      <!-- åŠ è½½çŠ¶æ€ -->
      <view wx:if="{{loading}}" class="loading">
        <view class="loading-spinner"></view>
        <text>æ­£åœ¨åŠ è½½...</text>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view wx:elif="{{!loading && ((tabIndex === 0 && videoList.length === 0) || (tabIndex === 1 && likedVideos.length === 0) || (tabIndex === 2 && collectedVideos.length === 0))}}" class="empty-state">
        <view class="empty-icon">ğŸ“±</view>
        <text class="empty-text">
          {{tabIndex === 0 ? 'è¿˜æ²¡æœ‰å‘å¸ƒä½œå“' : tabIndex === 1 ? 'è¿˜æ²¡æœ‰å–œæ¬¢çš„è§†é¢‘' : 'è¿˜æ²¡æœ‰æ”¶è—çš„è§†é¢‘'}}
        </text>
        <text class="empty-hint">
          {{tabIndex === 0 ? 'å¿«å»åˆ›ä½œä½ çš„ç¬¬ä¸€ä¸ªè§†é¢‘å§ï¼' : tabIndex === 1 ? 'å»å‘ç°æ›´å¤šç²¾å½©å†…å®¹' : 'æ”¶è—å–œæ¬¢çš„ä½œå“éšæ—¶å›çœ‹'}}
        </text>
        <button wx:if="{{tabIndex === 0}}" class="btn btn-primary btn-round btn-medium" bindtap="onRefresh">åˆ·æ–°æ•°æ®</button>
      </view>
    </view>

  </scroll-view>
  
  <!-- è‡ªå®šä¹‰åº•éƒ¨å¯¼èˆª -->
  <custom-tabbar></custom-tabbar>
</view> 